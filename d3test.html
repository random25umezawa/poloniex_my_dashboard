<script src="plugin/d3.min.js"></script>
<script src="plugin/jquery.min.js"></script>
<svg id="svgelement" style="width:100%;"></svg>
<script>
	var width = 500;
	var height = 300;

	var dataset = [3,14,15,92,65,35,89,79];
	var dataLimitLine = [50,80,46];
	var scale = d3.scaleLinear().domain([0,100]).range([0,height]);
	var line = d3.line()
		.x(function(d,i) {return i*width/dataset.length;})
		.y(function(d,i) {return height-scale(d);})
	;

	function updateGraph() {
		d3.select("#svgelement").selectAll("path")
			.transition()
			.delay(function(d,i) {return i*25})
			.duration(500)
			.attr("d",line(dataset))
			.attr("stroke","blue")
			.attr("stroke-width",2)
			.attr("fill","none")
		;
		d3.select("#svgelement").selectAll("line")
			.data(dataLimitLine)
			.attr("x1",0)
			.attr("x2",width)
			.attr("y1",function(d){return scale(d)})
			.attr("y2",function(d){return scale(d)})
			.attr("stroke","red")
			.attr("stroke-width",3)
		;
	}
	d3.select("body").selectAll("p")
		.data(dataset)
		.enter()
		.append("p")
		.text(function(d){return "Im "+d;})
		.attr({style:"background-color:#456"});

	$(document).ready(function() {
		d3.select("#svgelement")
			.append("path")
		;
		d3.select("#svgelement").selectAll("line")
			.data(dataLimitLine)
			.enter()
			.append("line")
			.on("mouseover",function(d) {
				console.log(d);
				console.log(this);
				console.log(d3.select(this));
				var myline = $(this);
				console.log(myline.offset());
				console.log(Number(myline.attr("x1"))+Number(myline.attr("x2")));
			})
			.on("mouseout",function(d) {
				console.log(d+100);
			})
		;
		resizeGraph();
		var timer = setInterval(function() {
			dataset.push((Math.random())*100);
			if(dataset.length>12) dataset.shift();
			updateGraph();
			//if(count>=100) clearInterval(timer);
		},500);
	});

	var timer = 0;
	$(window).resize(function() {
		if(timer>0) clearTimeout(timer);
		timer = setTimeout(function() {
			resizeGraph();
		},100)
	});

	function resizeGraph() {
		var svgelement = $("#svgelement");
		width = svgelement.width();
		height = width*3/5;
		svgelement.height(height);
		updateGraph();
	}
</script>
